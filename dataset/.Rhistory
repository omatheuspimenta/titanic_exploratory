#####
# Set path
setwd("/home/matheus/Dropbox/06_doutorado/2021_01/Bioestatistica/projeto/dataset/")
#####
# Libraries
library("Hmisc") #for describe
library("stringr") #for string manipulation
library("ggplot2") #for graphics
library("plyr") #for count
library("dplyr") #for summary
library("boot") #for bootstrap
#####
# Load file
load("titanic3.sav")
# 745      564      368
#
# lowest : ?Havana, Cuba                   Aberdeen / Portland, OR         Albany, NY                      Altdorf, Switzerland            Amenia, ND
# highest: Worcester, England              Worcester, MA                   Yoevil, England / Cottage Grove Youngstown, OH                  Zurich, Switzerland
# --------------------------------------------------------------------------------------------------------
#####
# Now, we will see column by column to find "gold information"
# The columns "pclass" and "survived" do not have any "new" information until here.
# In the column "name" we can extract the "Mr", "Mrs",... of the observation
# and copy to a new column "title"
titanic3$title <- str_split_fixed(titanic3$name, " ",3)[,2]
# Extracting the last name for other analysis
titanic3$lastname <- str_split_fixed(titanic3$name, " ",3)[,1]
# Input the new values in NA using the bootstrap strategy
f <- function(x,i){
xx<-x[i]
return(mean(xx, na.rm=TRUE))
}
R <- 1000 # use 10000 if need
pclass <- c("1st", "2nd", "3rd")
i_1 <- which(is.na(titanic3[titanic3$pclass=="1st",]$age))
i_2 <- 323 + which(is.na(titanic3[titanic3$pclass=="2nd",]$age))
i_3 <- 600 + which(is.na(titanic3[titanic3$pclass=="3rd",]$age))
for (c in pclass){
if(c=="1st"){
for(i in i_1){ # because the dataset is ordered
input <- titanic3[titanic3$pclass==c,]$age
if(is.na(titanic3$age[i])){
b <- boot(input, f, R=R)
if(mean(b$t) < 1){
output <- mean(b$t)
}else{
output <- round(mean(b$t))
}
titanic3$age[i] <- output
}
}
}
if(c=="2nd"){
for(i in i_2){ # because the dataset is ordered
input <- titanic3[titanic3$pclass==c,]$age
if(is.na(titanic3$age[i])){
b <- boot(input, f, R=R)
if(mean(b$t) < 1){
output <- mean(b$t)
}else{
output <- round(mean(b$t))
}
titanic3$age[i] <- output
}
}
}
if(c=="3rd"){
for(i in i_3){ # because the dataset is ordered
input <- titanic3[titanic3$pclass==c,]$age
if(is.na(titanic3$age[i])){
b <- boot(input, f, R=R)
if(mean(b$t) < 1){
output <- mean(b$t)
}else{
output <- round(mean(b$t))
}
titanic3$age[i] <- output
}
}
}
}
# remove temp variables
remove(c,i,input,output,pclass,R,f,b,i_1,i_2,i_3)
# The columns "sibsp", "parch" and "ticket" do not have any "new"
# information until here.
# The column "fare" has one NA value, let's see this.
# Finding 'NA' in fare
titanic3[which(is.na(titanic3$fare)),]
# Replacing the value using the bootstrap strategy. How the NA values
# are in the "3rd" class, we assume the mean by class.
f <- function(x,i){
xx<-x[i]
return(mean(xx, na.rm=TRUE))
}
R <- 1000 # use 10000 if need
input <- titanic3[titanic3$pclass=="3rd",]$fare
b <- boot(input, f, R=R)
i <- which(is.na(titanic3$fare))
titanic3$fare[i] <- mean(b$t)
#remove temp variables
remove(f,R,input,b,i)
# In the column "cabin" we can't impute the NA information yet.
# One way to do this is to associate the last name with the cabin,
# but that information isn't available.
# The column "embarked" has 2 NA values. Let's see.
i_n<-which(is.na(titanic3$embarked))
titanic3[which(is.na(titanic3$embarked)),]
# The 2 values belong to the "1st" class.
t<-table(titanic3$embarked,titanic3$pclass)
c<-prop.table(t[,1])
x<-c("Cherbourg", "Queenstown", "Southampton")
# The frequency of "Cherbourg" and "Southamptom" is very close.
# Input new values in NA
for (i in i_n){
titanic3$embarked[i]<-sample(x,1,prob = c)
}
remove(i_n,t,c,x,i)
# In the columns "boat", "body" and, "home.dest" we will not explore yet.
# Two new columns will be creating: "mom" and "nfamily".
# nfamily represents the number of relatives
# number of siblings + number of parents + 1 (the observation)
titanic3$nfamily <- titanic3$sibsp + titanic3$parch + 1
# mom represents if the woman is mom or not, to create only if the age > 18 and
# parch > 1
titanic3$mom <- ifelse((titanic3$sex=="female" & titanic3$parch>=1 & titanic3$age > 18), 1, 0)
# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# mom
#    n  missing distinct     Info      Sum     Mean      Gmd
# 1309        0        2    0.239      114  0.08709   0.1591
#
# -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------                                                                                                                             -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
# Creating dummy variables for "pclass", "sex", "sibsp", "parch", "embarked", "age"
# and, "nfamily"
# using the base R
# pclass dummy
titanic3$pclass1st <- ifelse(titanic3$pclass=="1st",1,0)
titanic3$pclass2nd <- ifelse(titanic3$pclass=="2nd",1,0)
titanic3$pclass3rd <- ifelse(titanic3$pclass=="3rd",1,0)
# sex dummy
titanic3$female <- ifelse(titanic3$sex=="female",1,0)
titanic3$male <- ifelse(titanic3$sex=="male",1,0)
# sibsp dummy
titanic3$sibsp0 <- ifelse(titanic3$sibsp==0,1,0)
titanic3$sibsp1 <- ifelse(titanic3$sibsp==1,1,0)
titanic3$sibsp2 <- ifelse(titanic3$sibsp==2,1,0)
titanic3$sibsp3 <- ifelse(titanic3$sibsp==3,1,0)
titanic3$sibsp4 <- ifelse(titanic3$sibsp==4,1,0)
titanic3$sibsp5 <- ifelse(titanic3$sibsp==5,1,0)
titanic3$sibsp8 <- ifelse(titanic3$sibsp==8,1,0)
# parch dummy
titanic3$parch0 <- ifelse(titanic3$parch==0,1,0)
titanic3$parch1 <- ifelse(titanic3$parch==1,1,0)
titanic3$parch2 <- ifelse(titanic3$parch==2,1,0)
titanic3$parch3 <- ifelse(titanic3$parch==3,1,0)
titanic3$parch4 <- ifelse(titanic3$parch==4,1,0)
titanic3$parch5 <- ifelse(titanic3$parch==5,1,0)
titanic3$parch6 <- ifelse(titanic3$parch==6,1,0)
titanic3$parch9 <- ifelse(titanic3$parch==9,1,0)
# embarked dummy
titanic3$Cherbourg <- ifelse(titanic3$embarked == "Cherbourg",1,0)
titanic3$Queenstown <- ifelse(titanic3$embarked == "Queenstown",1,0)
titanic3$Southampton <- ifelse(titanic3$embarked == "Southampton",1,0)
# age dummy
titanic3$children <- ifelse(titanic3$age<=11, 1, 0)
View(titanic3)
titanic3$teenage <- ifelse((titanic3$age>11 & titanic3$age<20), 1, 0)
titanic3$young <- ifelse((titanic3$age>20 & titanic3$age<30), 1, 0)
titanic3$adult <- ifelse((titanic3$age>30 & titanic3$age<60), 1, 0)
titanic3$old <- ifelse(titanic3$age>60, 1, 0)
# nfamily dummy
titanic3$nfamily1 <- ifelse(titanic3$nfamily == 1,1,0)
titanic3$nfamily2 <- ifelse(titanic3$nfamily == 2,1,0)
titanic3$nfamily3 <- ifelse(titanic3$nfamily == 3,1,0)
titanic3$nfamily4 <- ifelse(titanic3$nfamily == 4,1,0)
titanic3$nfamily5 <- ifelse(titanic3$nfamily == 5,1,0)
titanic3$nfamily6 <- ifelse(titanic3$nfamily == 6,1,0)
titanic3$nfamily7 <- ifelse(titanic3$nfamily == 7,1,0)
titanic3$nfamily8 <- ifelse(titanic3$nfamily == 8,1,0)
titanic3$nfamily11 <- ifelse(titanic3$nfamily == 11,1,0)
# save the file
save.image("titanic3.RData")
